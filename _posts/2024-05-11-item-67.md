---
layout: post
title: item 67 최적화는 신중히 하라
date: 2024-05-11 23:16 +0900
---


# 최적화는 신중히 하라


## 새겨들어야할 조언 3개

1. 어떤 핑계보다 효율성이라는 이름 아래 행해진 컴퓨팅 죄악이 많다 (심지어는 효율을 올리지도 못하면서)
2. 전체의 97퍼정도인 자그마한 효율성은 모두 잊자. 섣부른 최적화가 만악의 근원이다
3. 최적화를 할 떄는 다음 두 규칙을 따른다. 첫번째 하지마라. 두번째. 아직 하지마라. 완전히 명백하고 최적화되지않은 해법을 찾을때까진 하지마라

- 최적화는 좋기보단 해로운 결과를 가져올 것이다. 섣불리 진행하면 더더욱 그렇다
- 성능때문에 견고한 구조를 희생하지는 말자


## 성능을 제한하는 설계를 피하라

- 완성후 변경하기가 제일 어려운 설계 요소는 소통방식이다. API, 네트워크프로토콜 등이 대표적이다
- 이런 설계요소는 시스템성능을 심각하게 제한할 수 있다

## API 설계시 성능이 주는 영향을 고려하라
- public type을 가변으로 만들면 내부 데이터가 변경가능해진다. 이러면 방어적복사를 수없이 유발할 수 있다
- 컴포지션으로 해결할 수 있음에도 상속으로 설계한 퍼블릭 클래스는 상위클래스에 영원히 종속되며 그 성능 제약도 물려받는다
- 인터페이스가 있는 굳이 구현타입을 쓰는것도 좋지 않다

### API 설계가 성능에 주는 영향은 현실적인 문제다

- 잘 설계된 API는 성능도 좋은 편이다
- 성능을 위해 API를 왜곡하는건 매우 안좋은 생각이다

## 각각의 최적화 시도 전후로 성능을 측정하라

- 시도한 최적화기법이 성능을 크게 올려주지 못하는 경우가 많음을 깨달을 거다
- 심지어 더 나빠질 수도 있다. 그 이유는 우리가 성능 저하의 부분을 추측하기가 어렵기 때문이다
- 일반적으로 90%의 시간을 단 10%의 코드에서 사용한다는 사실을 기억해두자

### 프로파일링 도구는 이러한 최적화 노력을 어디에 집중할지를 알려준다

- 메서드 소비 시간과 호출횟수같은 런타임 정보를 제공해준다
- 시스템규모가 커질수록 프로파일러는 더 중요해진다
- 마이크로 벤치마킹 도구인 JMH도 성능을 알기 쉽게 도와준다

## 자바는 성능 변화를 일정하게 예측하기가 더 어렵다
- 자바의 성능모델은 정교하지않을뿐더러 구현시스템과 프로세서마다 다르다

> 빠른 프로그램을 작성하려 안달하지말자. 좋은 프로그램을 만들다보면 성능은 따라온다. 하지만 API와 네트워크프로토콜을 설계할 때는 
> 성능을 염두에 두어야 한다. 시스템 구현을 완료했다면 이제 성능을 측정해보라.

